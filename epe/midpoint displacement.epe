{
  "name": "midpoint displacement",
  "id": "36h5YYz2jeCqkiZjj",
  "sources": {
    "main": "/*\n  Midpoint displacement\n  \n  Recursive midpoint displacement to generate a pseudorandom 1D height map\n  \n  Generously contributed by zranger1 (Jon) from the Pixelblaze forums.\n    https://github.com/zranger1\n*/\n\n\n// Various variables\nvar  heightMap = array(pixelCount);\nvar  maxDisplacement = 10;        // maximum height change at level 1\n\n// Initial parameters chosen by eyeball.  Many interesting things are\n// possible, so please play with the sliders! Palette width and offset\n// are good places to start. The relevant variables\n// are exported so you can watch them in your browser.\nexport var speed = 0.03;          // 0.015 = 1 palette cycle / second\nexport var roughness = 1.4;       // change in max displacement per level\nexport var paletteWidth = 0.15;   \nexport var paletteOffset = 0;     \nexport var mapLifetime = 5000;    // in milliseconds, 0 == forever. \nexport var maxLevel = calcMaxRecursionDepth();\n\n// working globals for animation\nvar  t1;\nvar  xOffset;\nvar  mapTimer = 0;\n\n// max is power of 2 nearest to, but less than pixelCount. \n// absolute max is 7 -- above that, none of my Pixelblazes\n// will go.  \nfunction calcMaxRecursionDepth() {\n  return min(7, floor(log2(pixelCount)))\n}\n\nfunction triggerNewMap() {\n  mapTimer = mapLifetime;\n}\n\n// UI\nexport function sliderMaxLevel(v) {\n  maxLevel = floor(calcMaxRecursionDepth() * v);\n  triggerNewMap();\n}\n\nexport function slidermapLifetime(v) {\n  mapLifetime = floor(30000 * v);\n  triggerNewMap();\n}\n\nexport function sliderSpeed(v) {\n  speed = 0.1 * (1-v);\n}\n\nexport function sliderPaletteWidth(v) {\n  paletteWidth = v;\n}\n\nexport function sliderPaletteOffset(v) {\n  paletteOffset = v;\n}\n\nexport function sliderRoughness(v) {\n  roughness = 0.3 + (2.7 * v);\n  triggerNewMap();\n}\n\n// calculate random offset proportionate to current level\nfunction displace(level) {\n   var d = (2 * maxDisplacement) / pow(roughness,level);\n   return d - random(2 * d);\n}\n\n// displace initial segment endpoints and draw a smooth line\n// between them\nfunction initialize() {\n  heightMap[0] = displace(1);\n  heightMap[pixelCount - 1] = displace(1);\n  interpolate(0,pixelCount);\n}\n\n// rescale height map to range 0-1\nfunction normalize() {\n  var i,hMax,hMin,range;\n  \n  hMax = -32000;\n  hMin = 32000;\n  \n  for (i = 0; i < pixelCount; i++) {\n    if (heightMap[i] > hMax) { hMax = heightMap[i]; }\n    if (heightMap[i] < hMin) { hMin = heightMap[i]; }       \n  }\n  range = hMax - hMin;\n  \n  for (i = 0; i < pixelCount; i++) {\n    heightMap[i] = (heightMap[i] - hMin) / range;\n  }\n}\n\n// line between segment endpoints\nfunction interpolate(start, nPix) {\n  var m = (heightMap[start + nPix - 1] - heightMap[start]) / nPix;\n  \n  for (c = 1; c < nPix; c++ ) {\n    heightMap[c+start] = heightMap[start] + (m * c);\n  }\n}\n\n// given segment, find and displace midpoint, then subdivide\n// and repeat for each new segment\nfunction subdivide(indexStart,nPix,level) {\n    var i, newLen, indexMid;\n          \n// if we can't subdivide further, we're done \n    if (level > maxLevel) { return; }\n\n// find midpoint and add random height displacement\n    newLen = floor(nPix / 2);\n    indexMid = indexStart + newLen - 1;\n    heightMap[indexMid] += displace(level)\n    \n    interpolate(indexStart, newLen);\n    interpolate(indexMid,1 + nPix - newLen);\n\n// recursion! Do the same thing with our two new line segments    \n    level += 1;\n    subdivide(indexStart, newLen, level);\n    subdivide(indexMid, 1 + nPix - newLen, level);   \n}\n\n// create initial heightmap\ninitialize()\nsubdivide(0,pixelCount , 1);\nnormalize();   \n\n// beforeRender\nexport function beforeRender(delta) {\n   mapTimer += delta;\n\n   t1 = time(speed);\n\n// generate new height map every <mapLifetime> milliseconds \n// setting mapLifetime to 0 == forever\n   if (mapLifetime && (mapTimer > mapLifetime)) {\n     mapTimer = 0;\n\n     initialize();\n     subdivide(0,pixelCount, 1); \n     normalize();        \n   }\n}\n\n// render heightmap and do something inexpensive to animate \nexport function render(index) { \n  var h = (heightMap[index] + t1) % 1;\n  h = paletteOffset + (h * paletteWidth);\n  hsv(h,1,heightMap[index]);  \n}\n"
  },
  "preview": "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"
}