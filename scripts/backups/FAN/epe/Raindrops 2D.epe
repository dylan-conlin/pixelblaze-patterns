{
  "name": "Raindrops 2D",
  "id": "ebpdXxWpATjAsTF9X",
  "sources": {
    "main": "/* Raindrops Falling on a Pool\n\n Requires a 2D LED array and appropriate pixel mapper.\n This is designed for a 16x16 pixel array, and while it\n scales very well in terms of frame rate, it may run out of\n memory if used on anything with more than about 600\n total pixels (on a PB2).   \n\n MIT License\n \n Version  Author        Date      \n 1.0.0    JEM(ZRanger1) 04/09/2021\n*/ \n\n// display size - enter the dimensions of your matrix here\nvar width = 45;\nvar height = 45;\n\n// Global variables for rendering\nvar buffer1 = array(height);  // main drawing surface\nvar buffer2 = array(height);  // secondary drawing surface\nvar bgImage = array(height);  // static \"sea floor\" image.\nvar pb1, pb2;                 // buffer pointers for swapping\nvar speed = 765;              // max interval in milliseconds between drops\nvar nextDrop = speed;         // milliseconds to next drop (random)\nvar damping = 0.85;           // how quickly waves die down  \nvar frameTimer = 9999;        // accumulator for simulation timer\nvar dropTimer = 9999;         // accumulator for raindrop timer\n\n// UI\nexport function sliderRaindrops(v) {\n  speed = 150+1400*(1-v);\n}\n\n// create 2 x 2D buffers for calculation, and one\n// to hold our background image.\nfunction allocateFrameBuffers() {\n  for (var i = 0; i < height; i ++) {\n    buffer1[i] = array(width);\n    buffer2[i] = array(width);\n    bgImage[i] = array(width);\n  }\n  pb1 = buffer1;\n  pb2 = buffer2;\n}\n\n// generate a plausible pseudo-random underwater background.  Slowish, but only\n// has to be done during initialization. (This is the usual hand-tuned \n// sum-of-sine-waves texture)\nfunction initBackground() {\n  var m1 = random(8)-4;\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      var x1 = x / width; var y1 = y / height;\n      var dx = x - 0.5;  var dy = y - 0.5;      \n      var val = (wave(x1+y1) + wave(y1 * m1) + \n        wave(sqrt(x1*x1+y1*y1)) + wave(sqrt(dx*dx+dy*dy))) / 4;\n      bgImage[x][y] = 0.667 + (0.4*(val-0.8));\n    }\n  }  \n}\n\nfunction swapBuffers()  {\n  var tmp = pb1; pb1 = pb2; pb2 = tmp;\n}\n\n// No waves! No physics! We're just repeatedly applying a specialized\n// weighted \"blur\" filter which spreads the initial \"raindrop\" out\n// in a roughly circular fashion and attenuates it over time. \nfunction doRipples() {\n  swapBuffers();    \n\n  // we avoid having to clip or wrap our filter calculation by leaving a\n  // one pixel bounding region around the whole display. \n  for (var y = 1; y < height-1; y++) {\n    for (var x = 1; x < width-1; x++) {\n      var val = ((pb1[x-1][y] + pb1[x+1][y] + pb1[x][y-1] + pb1[x][y+1]) / 4) - pb2[x][y];\n      pb2[x][y] = (val * damping);\n    }\n  }\n}\n\n// Initialization\nallocateFrameBuffers();\ninitBackground();\n\nexport function beforeRender(delta) {\n  frameTimer += delta;\n  dropTimer += delta;\n\n  // raindrop timer is random, with upper bound set by the\n  // speed slider\n  if (dropTimer > nextDrop) {\n     var rx = 1+floor(random(width-2));\n     var ry = 1+floor(random(height-2));\n     pb1[rx][ry] = 1;\n    \n    nextDrop = random(speed);\n    dropTimer = 0;\n  }  \n  \n  // drop calculations are limited to 33/sec because it\n  // looks about right...\n  if (frameTimer > 30) {\n    doRipples();  \n    frameTimer = 0;\n  }\n}\n\nexport function render2D(index, x, y) {\n  // convert x and y to array indices\n  x = floor(x * width);  \n  y = floor(y * height);\n  // get wave height value (which we will use for brightness) from\n  // calculation buffer and gamma correct it\n  bri = 0.3+pb2[x][y]; bri = bri * bri;\n  // render background image using calculated brigtness,\n  // with slight desaturation at wave peaks\n  hsv(bgImage[x][y], 1.3-bri,bri);\n}"
  },
  "preview": "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"
}